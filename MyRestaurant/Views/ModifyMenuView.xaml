<Window x:Class="MyRestaurant.Views.ModifyMenuView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:converters="clr-namespace:MyRestaurant.Convertors"
        mc:Ignorable="d" 
        Title="Modify Menu"
        Height="500" Width="900"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <converters:NullToBoolMultiConverter x:Key="NullToBoolMultiConverter"/>
        <converters:MenuiriConvertor x:Key="MenuiriConvertor"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <!-- Wider column for menus -->
            <ColumnDefinition Width="3*"/>
            <!-- Wider column for preparate -->
        </Grid.ColumnDefinitions>

        <!-- Left Column - Menu Management -->
        <StackPanel Grid.Column="0">
            <Label Content="Menus" FontWeight="Bold" FontSize="14" Margin="5"/>
            <ListBox ItemsSource="{Binding MeniuriList}" 
                     SelectedItem="{Binding SelectedMeniu, Mode=TwoWay}"
                     DisplayMemberPath="Denumire"
                     Height="200" Margin="5"/>

            <!-- Labels and Inputs for Menu Name and Category -->
            <StackPanel Margin="5">
                <Label Content="Menu Name:"/>
                <TextBox Text="{Binding DenumireMeniu}" />
            </StackPanel>

            <StackPanel Margin="5">
                <Label Content="Category:"/>
                <ComboBox ItemsSource="{Binding CategoriList}" 
                          SelectedValue="{Binding SelectedCategoryId, Mode=TwoWay}"
                          SelectedValuePath="Idcategorie"
                          DisplayMemberPath="NumeCategorie"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="5" HorizontalAlignment="Left" >
                <Button Content="Add Menu" Command="{Binding AddMenu}" Margin="0,0,5,0">
                    <Button.CommandParameter>
                        <MultiBinding Converter="{StaticResource MenuiriConvertor}">
                            <Binding Path="DenumireMeniu"/>
                            <Binding Path="SelectedCategoryId"/>
                        </MultiBinding>
                    </Button.CommandParameter>
                </Button>

                <Button Content="Update" Command="{Binding UpdateMenu}" Margin="0,0,5,0"
                        IsEnabled="{Binding SelectedMeniu, Converter={StaticResource NullToBoolConverter}}">
                    <Button.CommandParameter>
                        <MultiBinding Converter="{StaticResource MenuiriConvertor}">
                            <Binding Path="DenumireMeniu"/>
                            <Binding Path="SelectedCategoryId"/>
                        </MultiBinding>
                    </Button.CommandParameter>
                </Button>

                <Button Content="Delete" Command="{Binding DeleteMenu}"
                        IsEnabled="{Binding SelectedMeniu, Converter={StaticResource NullToBoolConverter}}"/>
                <Button Content="Back" Command="{Binding BackCommand}" Margin="5,0,0,0"/>
            </StackPanel>
        </StackPanel>

        <!-- Right Column - Preparat Management -->
        <StackPanel Grid.Column="1">
            <Label Content="Preparate for Selected Menu" FontWeight="Bold" FontSize="14" Margin="5"/>

            <!-- ListBox showing preparate filtered by selected menu -->
            <ListBox ItemsSource="{Binding PreparateListForMenu}" 
                     DisplayMemberPath="Denumire" 
                     Height="150" Margin="5"
                     SelectedValue="{Binding SelectedPreparatId, Mode=TwoWay}"
                     SelectedValuePath="Idpreparat"/>

            <!-- Preparat selection and quantity inputs -->
            <StackPanel Margin="5" Visibility="{Binding SelectedMeniu, Converter={StaticResource NullToBoolConverter}}">
                <Label Content="Preparat:"/>
                <ComboBox ItemsSource="{Binding PreparateList}" 
                          SelectedValue="{Binding SelectedPreparatId, Mode=TwoWay}"
                          SelectedValuePath="Idpreparat"
                          DisplayMemberPath="Denumire"
                          Tag="Select Preparat"/>
            </StackPanel>

            <StackPanel Margin="5" Visibility="{Binding SelectedPreparatId, Converter={StaticResource NullToBoolConverter}}">
                <Label Content="Quantity:"/>
                <TextBox Text="{Binding CantitateInMeniu}" Tag="Quantity"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="5">
                <Button Content="Add Preparat" Command="{Binding AddPreparat}" Margin="0,0,5,0">
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource NullToBoolMultiConverter}">
                            <Binding Path="SelectedMeniu"/>
                            <Binding Path="SelectedPreparatId"/>
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
                <Button Content="Delete Preparat" Command="{Binding DeletePreparat}">
                    <Button.IsEnabled>
                        <MultiBinding Converter="{StaticResource NullToBoolMultiConverter}">
                            <Binding Path="SelectedMeniu"/>
                            <Binding Path="SelectedPreparatId"/>
                        </MultiBinding>
                    </Button.IsEnabled>
                </Button>
            </StackPanel>

            <TextBlock Text="{Binding ErrorMessage}" 
                       Foreground="Red" 
                       Margin="5"
                       Visibility="{Binding ErrorMessage, Converter={StaticResource NullToBoolConverter}}"/>
        </StackPanel>
    </Grid>
</Window>
